project:
    name: OutboundFundsNPSP
    package:
        name: Outbound Funds (npsp)
        namespace: lh6uuas
        api_version: "50.0"
    dependencies:
        - github: "https://github.com/SalesforceFoundation/NPSP"
        - github: "https://github.com/SFDO-Community/OutboundFunds"
    source_format: sfdx

orgs:
    scratch:
        dev_namespaced:
            config_file: orgs/dev.json
            days: 7
            namespaced: True
        prerelease:
            config_file: orgs/prerelease.json
        beta_prerelease:
            config_file: orgs/beta_prerelease.json
        2gp:
            config_file: orgs/2gp.json

tasks:
    # Automerge Major Release Branches
    github_automerge_feature:
        options:
            update_future_releases: True

    robot:
        options:
            suites: robot/OutboundFundsNPSP/tests
            options:
                outputdir: robot/OutboundFundsNPSP/results

    robot_testdoc:
        options:
            path: robot/OutboundFundsNPSP/tests
            output: robot/OutboundFundsNPSP/doc/OutboundFundsNPSP_tests.html

    load_storytelling_data:
        class_path: cumulusci.tasks.bulkdata.LoadData
        description: ""
        options:
            mapping: datasets/mapping.yml
            sql_path: datasets/data.sql

    extract_storytelling_data:
        class_path: cumulusci.tasks.bulkdata.ExtractData
        description: ""
        options:
            mapping: datasets/mapping.yml
            sql_path: datasets/data.sql

flows:
    dependencies:
        steps:
            1:
                task: update_dependencies
                options:
                    include_beta: False

    install_2gp_commit:
        steps:
            2:
                flow: dependencies
                options:
                    update_dependencies:
                        include_beta: False
                        dependencies: ^^github_package_data.dependencies
                        prefer_2gp_from_release_branch: True

    config_dev:
        steps:
            3:
                task: load_storytelling_data

    config_qa:
        steps:
            3:
                task: load_storytelling_data

    config_managed:
        steps:
            3:
                task: load_storytelling_data

    2gp_org:
        steps:
            1:
                flow: install_2gp_commit
            2:
                flow: config_managed
            3:
                task: snapshot_changes
